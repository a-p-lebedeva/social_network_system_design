# TravelSocialNetwork - System Design
System Design социальной сети для путешественников, домашнее задание по [курсу System Design](https://balun.courses/courses/system_design). 
TravelSocialNetwork — это платформа для обмена идеями и впечатлениями о путешествиях.

### Функциональные требования:

- Аутентификация пользователей
- Публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия с выбором из списка и добавлением нового места.
- Просмотр ленты других путешественников.
- Оценки и комментарии к постам других пользователей.
- Возможность подписки на других путешественников + отслеживание их активности.
- Поиск и просмотр популярных мест для путешествий + просмотр постов, связанных с этими местами.
- Только русский язык

### Нефункциональные требования:

- 10 000 000 уникальных пользователей в день
- Время ответа:
    - операции, содержащие фотографии (публикация, поиск и просмотр постов) - до 5 сек
    - операции без больших данных (добавление комментария, оценки, нового места, подписки) 1-3 сек
- Поведение пользователя:
    - публикует 2 поста в месяц, в каждый пост добавляет 6 фото, каждое не больше 1 MB, фото сжимаются с потерей качества перед сохранением в БД до 300 KB
    - просматривает ленту путешественников 1 в день, первые 3 страницы ленты
    - просматривает рейтинг мест 1 раз в неделю, первые 5 страниц рейтинга
    - просматривает посты для 3 мест в день, по 2 страницы каждого
    - по некокоторым местам читает суммарно 10 отзывов
    - просматривает комментарии к 10 отзывам, по 2 страницы комментариев
    - добавляет 3 комментария в день, максимум 50 комментариев в день
    - добавляет 3 оценки в день
    - подписывается на нового пользователя 1 раз в месяц
    - новые места добавляются редко, при расчете нагрузки можно пренебречь
- Доступность 99,95%
- Аудитория стран СНГ, летом и под новый год увеличивается нагрузка
- Посты, фотографии, реакции, комментарии храним всегда

## Оценка нагрузки

### Расчет RPS

RPS (добавление фото): 

    10 000 000 / 15 * 6 / 86400 ~= 50

RPS (публикация поста): 

    10 000 000 / 15 / 86400 ~= 10

RPS (просмотр ленты): 

    10 000 000 * 3 / 86400 ~= 350

RPS (просмотр рейтинга мест): 

    10 000 000 / 30 * 4 / 86400 * 5 ~= 80

RPS (просмотр списка постов локаций): 

    10 000 000 * 6 / 86400 ~= 700

RPS (просомтр фото):

    350 (в ленте) + 700 (посты по локациям) +  10 000 000 * 10 / 86400 (просмотр отзыва) = 2200

RPS (просмотр списка комментариев): 

    10 000 000 * 10 * 2 / 86400 ~= 2300

RPS (добавление комментария): 

    10 000 000 * 3 / 86400 ~= 350

RPS (добавление оценки): 

    10 000 000 * 3 / 86400 ~= 350

RPS (добавление подписки): 

    10 000 000 / 30 / 86400 ~= 5

RPS (добавление локации): 

    10 000 000 / 30 / 86400 ~= 5

### Расчет трафика

Добавление фото:

    310 KB * 50 req/s ~= 1550 KB/s

Публикация поста: 

    5 KB * 10 req/s ~= 50 KB/s

Просмотр ленты: 

    5 KB * 20 records * 350 req/s ~= 35 MB/s

Просмотр списка постов, связанных с местом: 

    5 KB * 20 records * 700 req/s ~= 70 MB/s

Получение фото при просмотре ленты: 

    1,8 MB * 20 records * 350 req/s ~= 13 GB/s - очень большой трафик, будем отдавать превью 10 KB, получим:
    60 KB * 20 records * 350 req/s ~= 420 MB/s

Получение фото при просмотре списка постов, связанных с местом: 

    60 KB * 20 records * 700 req/s ~= 420 MB/s
   
Получение фото при просмотре поста (отдаем полные картинки): 

     1,8 MB * 1150 req/s ~= 2 GB/s

Просмотр рейтинга мест: 

    4 KB * 20 records * 80 req/s ~= 6400 KB/s

Просмотр списка комментариев: 

    1 KB * 20 records * 2300 req/s ~= 46 MB/s

Добавление комментария: 
 
    1 KB * 350 req/s ~= 350 KB/s

Добавление оценки: 

    40 B * 350 req/s ~= 14 KB/s

Добавление подписки: 

    40 B * 5 req/s ~= 200 B/s

RPS (добавление локации): 

    5 KB * 5 req/s  ~= 24 KB/s


### Расчет памяти

Фотографии: 

    Data per year: 310 KB * 50 req/s * 86400 s * 365 = 455 TB
    Trafic: 1550 KB/s + 420 MB/s + 420 MB/s + 2 GB/s = 3 GB/s
    IOPS: 2250
    Disks: 6 SDD (SATA) by 100 TB 

Посты:

     Data per year: 50 KB/s * 86400 s * 365 = 1,5 TB
     Trafic: 50 KB/s + 35 MB/s + 70 MB/s = 105 MB/s
     IOPS: 10 + 700 + 350 = 1060
     RAM: 5 KB * 9 * 20 * 10 000 000 = 9 TB
     Disks: 1 SSD (SATA) by 2 TB + 10 TB RAM 
     
     
Локации:

     Data per year: 25 KB/s * 86400 s * 365 = 750 GB
     Trafic: 6400 KB/s + 24 KB/s =  7 MB/s
     IOPS: 705
     Disks: 1 SSD (SATA) by 1 TB
     
Комментарии:

     Data per year: 350 KB/s * 86400 s * 365 = 11 TB
     Trafic: 350 KB/s + 46 MB/s = 47 MB/s
     IOPS: 2650
     Disks: 4 SSD (SATA) by 4 TB

Подписки:

     Data per year: 200 B/s * 86400 s * 365 = 6 GB
     Trafic:  200 B/s
     IOPS: 5
     Disks: 1 HDD by 8 TB

Оценки:

     Data per year: 14 KB/s * 86400 s * 365 = 420 GB
     Trafic: 14 KB/s
     IOPS: 350
     Disks: 1 SSD (SATA) by 512 GB



